# Chapter 2 하드웨어 제어에 눈뜨다
마이크로프로세서는 주변 장치를 메모리로 인식 , LED, LCD, UART 같은 입출력 장치를 단순한 메모리로 다룸 

프로세서 입장에서는 주변 장치나 메모리를 구별하지 않고 더 간단하게 처리 가능

- 메모리 맵 I/O : 입출력 장치들이 사용하는 메모리 정해져 있지 않아, 직접 지정하여 사용
- I/O 맵 I/O : 입출력 장치들이 사용하는 메모리가 미리 정해져있는 방식


## 1. 하드웨어에 어떻게 접근하나 
소프트웨어에서 하드웨어는 메모리로 인식

입출력 포트에서 사용할 메모리를 지정하고, 지정된 메모리에 값을 읽거나 쓴다. 

포트가 사용하는 메모리에 필요한 값을 넣어주면 포트와 연결된 장치까지 데이터가 전달 된다 

    char *p = (char *) 0x30000000;

## 2. 하드웨어, 어떻게 제어하나 
사용할 포트를 어떤 모드로 사용할지 설정하고, 프로그램에서 데이터 레지스터에 값을 쓰거나 읽어오면 됨

장치의 레지스터를 다룰때에 조심할 점은 해당 비트만 수정해야 한다!

## 3. 특정 비트를 어떻게 제어하나

### 특정 비트 설정과 클리어
특정 비트를 1로 설정하려면 1과 | (OR) 연산

        01010101          01010101
    OR  00100000     AND  11111011
    -------------    --------------  
        01110101          01010001

    OR
    a |= 0x00100000;
    a |= 0x1<<5;
    a |= (0x1<<5) + (0x1<<3) + (0x1<<2);
    a |= (0x1<<5) + (0x3<<2);

    0x1<<5      0x0010_0000
    ~(0x1<<5)   0x1101_1111   


    AND
    a &= ~(0x1<<2)
    a &= ~((0x1<<5) + (0x3<<2))

### 특정 비트 반전 
XOR 연산 

    XOR
    a ^= 0x1<<5
    a ^= (0x1<<5) + (0x3<<2)

### 비트 검사
특정 비트가 0인지 1인지 검사

    a & (0x1<<5)

### 비트 추출
특정 비트만 추출 하는 방법

    [6:4] 비트만 추출
    a & 0x7 

### 비트 연산의 활용 
비트 연산을 응용하면 복잡한 로직도 짧은 코드로 만들 수 있다.

값을 무조건 4의 배수로 만들어야 할 때
    
    start = 100;
    scanf("%d", &x);
    start += x;
    start += 0x3;
    start &= 0x3;

    무조건 3을 더해주고 마지막 2비트를 클리어

### 비트 연산을 편하게
macro.h 로 만들어서 비트연산을 쉽게 사용할 수 있도록 만드는 것 


